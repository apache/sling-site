<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Jackrabbit Persistence</title>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <script src='https://www.apachecon.com/event-images/snippet.js'></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
	<!-- Matomo Web Analytics -->
	<script>
	var _paq = window._paq = window._paq || [];
	/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
	/* We explicitly disable cookie tracking to avoid privacy issues */
	_paq.push(['disableCookies']); 
	_paq.push(['trackPageView']);
	_paq.push(['enableLinkTracking']);
	(function() {
	  var u="https://matomo.privacy.apache.org/";
	  _paq.push(['setTrackerUrl', u+'matomo.php']);
	  _paq.push(['setSiteId', '6']);
	  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	  g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
	})();
	</script>
	<!-- End Matomo Code -->
	<link href='/pagefind/pagefind-ui.css' rel='stylesheet'><script src='/pagefind/pagefind-ui.js' type='text/javascript'></script>
	<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#searchbox" });
    });
	</script>
	
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><section class="searchbox level is-marginless">
                <div id="searchbox"></div>
            </section><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling12/index.html">Sling 12</a></li><li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Sitemap</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="/repolist.html">Repositories</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a class="acevent" data-format="square" data-event="random"></a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/tutorials-how-tos.html">
                                                Tutorials &amp; How-Tos
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/jcr.html">
                                        jcr
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/jackrabbit.html">
                                        jackrabbit
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/repository.html">
                                        repository
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            Jackrabbit Persistence
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row" data-pagefind-body="true"><div><section><div class="note">
Recent versions of Apache Sling no longer use Apache Jackrabbit as their persistence engine, but
Apache Jackrabbit Oak. Oak is configured in a different, more OSGi-friendly way. For more details,
see <a href="http://jackrabbit.apache.org/oak/docs/">The Jackrabbit Oak documentation</a>. The Jackrabbit integration has also been moved to the attic and is no longer maintained.
</div>
<p>Out-of-the-box the embedded Jackrabbit repository used by Sling (the Embedded Jackrabbit Repository bundle) uses Derby to persist the JCR nodes and properties. For some applications or environments it may be required or required to replace Derby with another backing store such as PostgreSQL or Oracle.</p>
<p>This page is based on the journey of Tony Giaccone to get Sling running with a PostgreSQL based Jackrabbit instance.</p>
<h2><a href="#management-summary" id="management-summary">Management Summary</a></h2>
<p>To replace Derby as the persistence manager for Jackrabbit the following steps are required:</p>
<ol>
<li>Provide a JDBC driver for your database as an OSGi bundle</li>
<li>Reconfigure Jackrabbit to use your database</li>
<li>(Re-) Start the Embedded Jackrabbit bundle</li>
</ol>
<p>When you are not using the Derby persistence manager, you may safely remove the Derby bundle from your Sling instance.</p>
<h2><a href="#jdbc-driver" id="jdbc-driver">JDBC Driver</a></h2>
<p>The hardest thing to do is probably getting the JDBC driver for your database. One option is to look at the bundles provided by Spring Source in their repository at <a href="http://www.springsource.com/repository/">http://www.springsource.com/repository/</a>.</p>
<p>Another option is to create the bundle on your own using Peter Kriens' <a href="http://bnd.bndtools.org/">bnd Tool</a>:</p>
<ol>
<li>Get the JDBC driver for your database from the driver provider</li>
<li>Wrap the JDBC driver library into an OSGi bundle:
<pre><code><!-- TODO syntax marker (::sh) disabled --># Example for PostgreSQL JDBC 3 driver 8.4-701
$ java -jar bnd.jar wrap postgresql-8.4-701.jdbc3.jar
$ mv postgresql-8.4-701.jdbc3.bar postgresql-8.4-701.jdbc3-bnd.jar
</code></pre>
</li>
<li>
<p>Deploy the driver to your local Maven 2 Repository (Required if adding the JDBC driver to a Maven build, e.g. using the Sling Launchpad Plugin)</p>
<pre><code><!-- TODO syntax marker (::sh) disabled -->$ mvn install:install-file \  
    -DgroupId=postgresql -DartifactId=postgresql -Dversion=8.4.701.jdbc3 \  
    -Dpackaging=jar -Dfile=postgresql-8.4-701.jdbc3-bnd.jar
</code></pre>
</li>
</ol>
<p>Tony reports no success with the Spring Source bundle, whily the bnd approach worked for the PostgreSQL JDBC driver.</p>
<h2><a href="#replace-derby-in-a-running-sling-instance" id="replace-derby-in-a-running-sling-instance">Replace Derby in a running Sling Instance</a></h2>
<p>To replace Derby in a running Sling instance follow these steps (e.g. through the Web Console at <code>/system/console</code>):</p>
<ol>
<li>Uninstall the Apache Derby bundle</li>
<li>Install the JDBC bundle prepared in the first step</li>
<li>Stop the Jackrabbit Embedded Repository bundle<br />
This needs to be reconfigured and restarted anyway. So lets just stop it to prevent failures in the next step.</li>
<li>Refresh the packages (click the <em>Refresh Packages</em> button)</li>
</ol>
<p>Alternatively, you may wish to stop Sling after uninstalling Derby and installing the JDBC bundle. Technically, this is not required, though.</p>
<h2><a href="#reconfiguring-jackrabbit" id="reconfiguring-jackrabbit">Reconfiguring Jackrabbit</a></h2>
<p>To actually use a persistence manager other than the default (Derby) persistence manager, you have to configure Jackrabbit to use it. Create a <code>repository.xml</code> file in the <code>sling/jackrabbit</code> folder before starting Sling for the first time. If the repository was already started, you can also modify the existing file.</p>
<p>To prepare a repository.xml file before first startup, use the <a href="https://svn.apache.org/repos/asf/sling/attic/jackrabbit-server/src/main/resources/repository.xml"><code>repository.xml</code></a> as a template and modify it by replacing the <code>&lt;PersistenceManager&gt;</code> elements to refer to the selected persistence manager.</p>
<p>If the file already exists, you can modifiy this existing file and there is no need to get the original from the SVN repository.</p>
<p>For example to use PostgreSQL instead of Derby modify the <code>&lt;PersistenceManager&gt;</code> elements as follows:</p>
<pre><code><!-- TODO syntax marker (::xml) disabled -->&lt;Repository&gt;
    ...
    &lt;Workspace name=&quot;${wsp.name}&quot;&gt;
        ...
        &lt;PersistenceManager class=&quot;org.apache.jackrabbit.core.persistence.bundle.PostgreSQLPersistenceManager&quot;&gt;
            &lt;param name=&quot;driver&quot; value=&quot;org.postgresql.Driver&quot;/&gt;
            &lt;param name=&quot;url&quot; value=&quot;jdbc:postgresql://localhost:5432/YOUR_DB_NAME_HERE&quot;/&gt;
            &lt;param name=&quot;schema&quot; value=&quot;postgresql&quot;/&gt;
            &lt;param name=&quot;user&quot; value=&quot;YOUR_USER_HERE&quot;/&gt;
            &lt;param name=&quot;password&quot; value=&quot;YOUR_PASSWORD_HERE&quot;/&gt;
            &lt;param name=&quot;schemaObjectPrefix&quot; value=&quot;jcr_${wsp.name}_&quot;/&gt;
            &lt;param name=&quot;externalBLOBs&quot; value=&quot;false&quot;/&gt;
        &lt;/PersistenceManager&gt;
        ...
    &lt;/Workspace&gt;

    &lt;Versioning rootPath=&quot;${rep.home}/version&quot;&gt;
        ...
        &lt;PersistenceManager class=&quot;org.apache.jackrabbit.core.persistence.bundle.PostgreSQLPersistenceManager&quot;&gt;
            &lt;param name=&quot;driver&quot; value=&quot;org.postgresql.Driver&quot;/&gt;
            &lt;param name=&quot;url&quot; value=&quot;jdbc:postgresql://localhost:5432/YOUR_DB_NAME_HERE&quot;/&gt;
            &lt;param name=&quot;schema&quot; value=&quot;postgresql&quot;/&gt;
            &lt;param name=&quot;user&quot; value=&quot;YOUR_USER_HERE&quot;/&gt;
            &lt;param name=&quot;password&quot; value=&quot;YOUR_PASSWORD_HERE&quot;/&gt;
            &lt;param name=&quot;schemaObjectPrefix&quot; value=&quot;version_&quot;/&gt;
            &lt;param name=&quot;externalBLOBs&quot; value=&quot;false&quot;/&gt;
        &lt;/PersistenceManager&gt;
    &lt;/Versioning&gt;
    ...
&lt;/Repository&gt;
</code></pre>
<p>Modify the <code>url</code>, <code>user</code>, and <code>password</code> parameters to match your database setup.</p>
<p>If you reconfigure Jackrabbit to use the new persistence manager, the existing repository data in the <code>sling/jackrabbit</code> directory, except the <code>repository.xml</code> file, of course, should now be removed.</p>
<p>Finally either start Sling or start the Jackrabbit Embedded Repository bundle.</p>
<h2><a href="#credits" id="credits">Credits</a></h2>
<p>This description is based on Tony Giaccone's description <a href="http://markmail.org/message/wlbfrukmjjsl33hh">Swapping Postgres for Derby</a> sent to the Sling Users mailing list.</p>
</section></div></div><div data-pagefind-body="true" data-pagefind-weight="7.0" style="display:none;"> - ( Jackrabbit Persistence )</div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="editpagelink">
                        This page can be edited on GitHub at <a href="https://github.com/apache/sling-site/edit/master/src/main/jbake/content/documentation/tutorials-how-tos/jackrabbit-persistence.md">
                            content/documentation/tutorials-how-tos/jackrabbit-persistence.md
                        </a>
                    </div>                    <div class="revisionInfo">
                        Last modified by <span class="author">Thomas Wolfart</span> on <span class="comment">2018-07-17</span>
                    </div><p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project
    logo are trademarks of The Apache Software Foundation. All other marks mentioned 
    may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright © 2007-2024<a href="https://www.apache.org/">
                            The Apache Software Foundation
                        </a>|<a href="https://privacy.apache.org/policies/privacy-policy-public.html">
                            Privacy Policy
                        </a>
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>