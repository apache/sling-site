<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: JCR Mocks</title>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <script src='https://www.apachecon.com/event-images/snippet.js'></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
	<!-- Matomo Web Analytics -->
	<script>
	var _paq = window._paq = window._paq || [];
	/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
	/* We explicitly disable cookie tracking to avoid privacy issues */
	_paq.push(['disableCookies']); 
	_paq.push(['trackPageView']);
	_paq.push(['enableLinkTracking']);
	(function() {
	  var u="https://matomo.privacy.apache.org/";
	  _paq.push(['setTrackerUrl', u+'matomo.php']);
	  _paq.push(['setSiteId', '6']);
	  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	  g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
	})();
	</script>
	<!-- End Matomo Code -->
	<link href='/pagefind/pagefind-ui.css' rel='stylesheet'><script src='/pagefind/pagefind-ui.js' type='text/javascript'></script>
	<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#searchbox" });
    });
	</script>
	
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><section class="searchbox level is-marginless">
                <div id="searchbox"></div>
            </section><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling12/index.html">Sling 12</a></li><li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Sitemap</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="/repolist.html">Repositories</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a class="acevent" data-format="square" data-event="random"></a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/development.html">
                                                Development
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/development.html">
                                        development
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/testing.html">
                                        testing
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/mocks.html">
                                        mocks
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            JCR Mocks
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row" data-pagefind-body="true"><div><section><p>Mock implementation of selected JCR APIs for easier testing. It stores all data in-memory in a HashMap to ensure instantly creating and destroying of the JCR repository.</p>
<p><!-- TODO reactivate TOC once JBake moves to flexmark-java -->
</p>
<h2><a href="#maven-dependency" id="maven-dependency">Maven Dependency</a></h2>
<pre><code><!-- TODO syntax marker (#!xml) disabled -->&lt;dependency&gt;
  &lt;groupId&gt;org.apache.sling&lt;/groupId&gt;
  &lt;artifactId&gt;org.apache.sling.testing.jcr-mock&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>See latest version on the <a href="/downloads.cgi">downloads page</a>.</p>
<h2><a href="#implemented-mock-features" id="implemented-mock-features">Implemented mock features</a></h2>
<p>The mock implementation supports:</p>
<ul>
<li>Reading and writing all data (primitive values, arrays, binary data) via the JCR API</li>
<li>Creating any number of nodes and properties (stored in-memory in a hash map)</li>
<li>Register namespaces</li>
<li>Queries are supported by setting expected results for a given query</li>
</ul>
<p>The following features are <em>not supported</em>:</p>
<ul>
<li>Node types are supported in the API, but their definitions and constraints are not applied</li>
<li>Versioning not supported</li>
<li>Transactions not supported</li>
<li>Observation events can be registered but are ignored</li>
<li>Access control always grants access</li>
<li>Exporting/Importing data via document and system views not supported</li>
<li>Workspace management methods not supported</li>
</ul>
<h2><a href="#usage" id="usage">Usage</a></h2>
<h3><a href="#getting-jcr-mock-objects" id="getting-jcr-mock-objects">Getting JCR mock objects</a></h3>
<p>The factory class <code>MockJcr</code> allows to instantiate the different mock implementations.</p>
<p>Example:</p>
<pre><code><!-- TODO syntax marker (#!java) disabled -->// get session
Session session = MockJcr.newSession();

// get repository
Repository repository = MockJcr.newRepository();
</code></pre>
<p>The repository is empty and contains only the root node. You can use the JCR API to read or write content.</p>
<h3><a href="#mocking-queries" id="mocking-queries">Mocking queries</a></h3>
<p>If you want to test code that contains a JCR query you can simulate a query execution and set the result to return during setting up your unit test.</p>
<p>Example:</p>
<pre><code><!-- TODO syntax marker (#!java) disabled -->// prepare mocked search result
List&lt;Node&gt; resultNodes = ImmutableList.of(node1, node2, node3);

// return this result for all queries
MockJcr.setQueryResult(session, resultNodes);

// return this result for a specific query
MockJcr.setQueryResult(session, &quot;your query statement&quot;, Query.JCR_SQL2, resultNodes);
</code></pre>
<p>Alternatively you can use the <code>MockJcr.addQueryResultHandler</code> method to pass a callback object that allows you to return a query result after inspecting the given query object.</p>
<h3><a href="#mocking-node-type-management" id="mocking-node-type-management">Mocking node type management</a></h3>
<p><em>Since Version 1.6.8</em></p>
<p>If you want to test code that interacts with node types you can simulate real node type definitions while setting up your unit test.</p>
<p>Example:</p>
<pre><code>String[] cndResourcesToLoad = new String[] {
        &quot;/org/apache/jackrabbit/oak/builtin_nodetypes.cnd&quot;,
        &quot;/your/test/nodetypes.cnd&quot;
};
for (String resourceName : cndResourcesToLoad) {
    URL cndUrl = getClass().getResource(resourceName);
    if (cndUrl == null) {
        fail(&quot;Failed to load CND nodetypes resource: &quot; + resourceName);
    }
    try (Reader reader = new InputStreamReader(cndUrl.openStream())) {
        MockJcr.loadNodeTypeDefs(session, reader);
    }
}
</code></pre>
<h3><a href="#mocking-access-control-manager" id="mocking-access-control-manager">Mocking access control manager</a></h3>
<p><em>Since Version 1.6.8</em></p>
<p>If you want to test code that interacts with the access control manager you can set your own mock implementation while setting up your unit test.</p>
<p>Example:</p>
<pre><code>AccessControlManager acm = Mockito.mock(AccessControlManager.class);
MockJcr.setAccessControlManager(jcrSession, acm);
</code></pre>
</section></div></div><div data-pagefind-body="true" data-pagefind-weight="7.0" style="display:none;"> - ( JCR Mocks )</div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="editpagelink">
                        This page can be edited on GitHub at <a href="https://github.com/apache/sling-site/edit/master/src/main/jbake/content/documentation/development/jcr-mock.md">
                            content/documentation/development/jcr-mock.md
                        </a>
                    </div>                    <div class="revisionInfo">
                        Last modified by <span class="author">Eric Norman</span> on <span class="comment">2023-04-27</span>
                    </div><p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project
    logo are trademarks of The Apache Software Foundation. All other marks mentioned 
    may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright © 2007-2024<a href="https://www.apache.org/">
                            The Apache Software Foundation
                        </a>|<a href="https://privacy.apache.org/policies/privacy-policy-public.html">
                            Privacy Policy
                        </a>
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>