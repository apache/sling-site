<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Resource Merger (org.apache.sling.resourcemerger)</title>
        <link rel="icon" href="/res/favicon.ico"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
<div class="title">
            <div class="logo">
                <a href="http://sling.apache.org">
                    <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                </a>
            </div><div class="header">
                <a href="http://www.apache.org">
                    <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                </a>
            </div>
        </div><div class="menu">
            <p>
                <strong><a href="/documentation.html">Documentation</a></strong><br/>
                <a href="/documentation/getting-started.html">Getting Started</a><br/>
                <a href="/documentation/the-sling-engine.html">The Sling Engine</a><br/>
                <a href="/documentation/development.html">Development</a><br/>
                <a href="/documentation/bundles.html">Bundles</a><br/>
                <a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a><br/>
                <a href="/documentation/configuration.html">Configuration</a>
            </p><p>
                <a href="http://s.apache.org/sling.wiki">Wiki</a><br/>
                <a href="http://s.apache.org/sling.faq">FAQ</a><br/>
                
            </p><p>
                <strong>API Docs</strong><br/>
                <a href="/apidocs/sling9/index.html">Sling 9</a><br/>
                <a href="/apidocs/sling8/index.html">Sling 8</a><br/>
                <a href="/apidocs/sling7/index.html">Sling 7</a><br/>
                <a href="/apidocs/sling6/index.html">Sling 6</a><br/>
                <a href="/apidocs/sling5/index.html">Sling 5</a><br/>
                <a href="/javadoc-io.html">Archive at javadoc.io</a><br/>
                
            </p><p>
                <strong>Project Info</strong><br/>
                <a href="/downloads.cgi">Downloads</a><br/>
                <a href="http://www.apache.org/licenses/">License</a><br/>
                <a href="/news.html">News</a><br/>
                <a href="/releases.html">Releases</a><br/>
                <a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a><br/>
                <a href="/links.html">Links</a><br/>
                <a href="/contributing.html">Contributing</a><br/>
                <a href="/project-information.html">Project Information</a><br/>
                <a href="/project-information/security.html">Security</a><br/>
                
            </p><p>
                <strong>Source</strong><br/>
                <a href="http://svn.apache.org/viewvc/sling/trunk">Subversion</a><br/>
                <a href="git://git.apache.org/sling.git">Git</a><br/>
                <a href="https://github.com/apache/sling">Github Mirror</a><br/>
                
            </p><p>
                <strong>Sponsorship</strong><br/>
                <a href="http://www.apache.org/foundation/thanks.html">Thanks</a><br/>
                <a href="http://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a><br/>
                <a href="https://donate.apache.org/">Donate!</a><br/>
                <a href="http://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a><br/>
                
            </p><p>
                <strong><a href="/sitemap.html">Site Map</a></strong>
            </p>
        </div>        <div class="main">
<div class="breadcrumbs"><a href="/">Home</a>&nbsp;&raquo;&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo;&nbsp;<a href="/documentation/bundles.html">Bundles</a>&nbsp;&raquo;&nbsp;</div>            <h1 class="pagetitle">
                Resource Merger (org.apache.sling.resourcemerger)
            </h1><div id="generatedToC"></div><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=pagetitle],h2,h3'}); } );</script>
<div class="row"><div class="small-12 columns"><section class="wrap"><p><!-- TODO reactivate TOC once JBake moves to flexmark-java -->
</p>
<h1><a href="#introduction" name="introduction">Introduction</a></h1>
<p><strong>This documentation only applies to versions &gt;= 1.2 (due to major changes done in <a href="https://issues.apache.org/jira/browse/SLING-3423">SLING-3423</a>)</strong></p>
<p>The Resource Merger bundle provides two resource provider factories</p>
<ul>
  <li><code>MergingResourceProvider</code> (only for reading)</li>
  <li><code>CRUDMergingResourceProvider</code> (for reading and writing)</li>
</ul>
<p>Those providers give access to virtual resources which provide a merged view on multiple other resources.</p>
<p>Each <code>MergedResourcePicker</code> service implementation in the system provides one unique mount point/root path (usually starting with <code>/mnt</code>) exposing a view on merged resources from at least two different locations. </p>
<p>The exact merging mechanism depends on the resource picker implementation (see below). The order of the merging is important as the overlying resource may overwrite properties/child resources from the underlying resource (but not vice-versa). It is possible to</p>
<ul>
  <li>remove existing resource/properties from the underlying resources,</li>
  <li>modify existing properties/child resources of the underlying resources and</li>
  <li>add new properties/child resources</li>
</ul>
<p>You may use any of the merge properties described below to influence the merging behaviour. All those special properties are not exposed below the mount point. </p>
<p>The <code>CRUDMergingResourceProvider</code> not only gives read-access to the merged resources but even allows to write. This provider always writes inside the topmost resource path (being returned as last item by the resource picker). Currently both resource pickers shipped with the Sling Resource Merger bundle do not allow to write though. Further details can be found in the description of <a href="https://issues.apache.org/jira/browse/SLING-3909">SLING-3909</a>.</p>
<h1><a href="#merge-properties" name="merge-properties">Merge Properties</a></h1>
<table>
  <thead>
    <tr>
      <th>Property Name </th>
      <th>Type </th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>sling:hideProperties </td>
      <td>String[] </td>
      <td>Hides the properties with the given names. <code>*</code> hides all properties (since version 1.3.2 the wildcard only affects underlying properties and no longer local ones, see also <a href="https://issues.apache.org/jira/browse/SLING-5468">SLING-5468</a>).</td>
    </tr>
    <tr>
      <td>sling:hideChildren</td>
      <td>String[] </td>
      <td>Hides the child resources with the given names. <code>*</code> hides all child resources (since version 1.3.2 the wildcard only affects underlying child resources and no longer local ones, see also <a href="https://issues.apache.org/jira/browse/SLING-5468">SLING-5468</a>). If one value starts with <code>!</code> this is a negation (which means the property with the given value should not be hidden). Since by default nothing is hidden the negation is only useful if you specify multiple values for this property. E.g. giving the values <code>[!child1,*]</code> hides all children except for the one with the name <code>child1</code>. If you have a resource name starting with <code>!</code> you must escape it with an additional <code>!</code> in front if you want to reference it in <code>sling:hideChildren</code>, e.g. <code>!!child1</code> means that the resource with the name <code>!child1</code> should be hidden.</td>
    </tr>
    <tr>
      <td>sling:hideResource </td>
      <td>Boolean </td>
      <td>If <code>true</code> then the resource with the name which contains this property should not be exposed!</td>
    </tr>
    <tr>
      <td>sling:orderBefore </td>
      <td>String </td>
      <td>Contains the name of the preceding sibling resource. This is influencing the order of resources when calling e.g. <code>Resource.listChildren()</code> or <code>Resource.getChildren()</code> on the merged resource. This is only necessary if the default child resource order is not sufficient (see below).</td>
    </tr>
  </tbody>
</table>
<h1><a href="#child-resource-order" name="child-resource-order">Child Resource Order</a></h1>
<p>For a merged resource the order of its child resources is the following: First the ones from the underlying resource, then the ones from the overlying resources.</p>
<p>In case the same child is defined in more than one resource, its position is taken from the highest overlaying resource (since version 1.3.2, see also <a href="https://issues.apache.org/jira/browse/SLING-4915">SLING-4915</a>, for some more examples for more complicated merges look at <a href="https://issues.apache.org/jira/browse/SLING-6956">SLING-6956</a>). For example:</p>
<pre><code>base/
    +--child1
    +--child3
    +--child5

overlay/
    +--child2
    +--child3
    +--child4

resulting order: child1, child5, child2, child3, child4
</code></pre>
<p>You can overwrite that behaviour by leveraging the <code>sling:orderBefore</code> property.</p>
<h1><a href="#resource-pickers" name="resource-pickers">Resource Pickers</a></h1>
<h2><a href="#merging-resource-picker-overlay-approach-" name="merging-resource-picker-overlay-approach-">Merging Resource Picker (Overlay approach)</a></h2>
<table>
  <thead>
    <tr>
      <th>Description </th>
      <th>Merged Resource Path </th>
      <th>Merging Order </th>
      <th>Read-Only </th>
      <th>Related Ticket</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Merging based on the resource resolver's search path </td>
      <td><code>/mnt/overlay/&lt;relative resource path&gt;</code> </td>
      <td>Last resource resolver search path first (Order = Descending search paths). </td>
      <td><code>true</code> </td>
      <td><a href="http://issues.apache.org/jira/browse/SLING-2986">SLING-2986</a></td>
    </tr>
  </tbody>
</table>
<p>This picker is thought for globally overlaying content by placing the diff-resource in "/apps" without actually touching anything in "/libs" (since this is only thought for Sling itself). This should be used whenever some deviation of content is desired which is initially shipped with Sling. The client (i.e. the code using the merged resource) does not have to know if there is an overlay in place.</p>
<h3><a href="#example" name="example">Example</a></h3>
<pre><code>/libs/sling/example (nt:folder)
     +-- sling:resourceType = &quot;some/resource/type&quot;
     +-- child1 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child1&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;


/apps/sling/example (sling:Folder)
     +-- property1 = &quot;property added in apps&quot;
     +-- child1 (nt:folder)
     |   +-- sling:hideResource = true
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;


/mnt/overlay/sling/example (sling:Folder)
     +-- sling:resourceType = &quot;some/resource/type&quot;
     +-- property1 = &quot;property added in apps&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;
</code></pre>
<h2><a href="#overriding-resource-picker-override-approach-" name="overriding-resource-picker-override-approach-">Overriding Resource Picker (Override approach)</a></h2>
<table>
  <thead>
    <tr>
      <th>Description </th>
      <th>Merged Resource Path </th>
      <th>Merging Order </th>
      <th>Read-Only </th>
      <th>Related Ticket</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Merging based on the <code>sling:resourceSuperType</code> </td>
      <td><code>/mnt/override/&lt;absolute resource type&gt;</code> </td>
      <td>The topmost resource type (having itself no <code>sling:resourceSuperType</code> defined) is the base. The resources are overlaid in the order from the most generic one to the most specific one (which is the one having the most inheritance levels). </td>
      <td><code>true</code> </td>
      <td><a href="https://issues.apache.org/jira/browse/SLING-3657">SLING-3675</a></td>
    </tr>
  </tbody>
</table>
<p>This picker is thought for extending content of another already existing resource (which should not be modified). The client (i.e. the code using the merged resource) must directly reference the most specific resource type (i.e. it must be aware of the sub resource type).</p>
<h3><a href="#example" name="example">Example</a></h3>
<pre><code>/apps/sling/base (nt:folder)
     +-- child1 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child1&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;


/apps/sling/example (sling:Folder)
     +-- sling:resourceSuperType = &quot;/apps/sling/base&quot;
     +-- property1 = &quot;property added in /apps/sling/example&quot;
     +-- child1 (nt:folder)
     |   +-- sling:hideResource = true
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;


/mnt/override/apps/sling/example (sling:Folder)
     +-- sling:resourceSuperType = &quot;/apps/sling/base&quot;
     +-- property1 = &quot;property added in /apps/sling/example&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;
</code></pre></section></div></div>            
<div class="tags"><a href="/tags/resources.html" class="label">resources</a> </div>            
<div class="revisionInfo">Last modified by <span class="author">Bertrand Delacretaz</span> on <span class="comment">Fri Sep 29 15:57:01 2017 +0200</span></div>            
<div class="footer">
                <div class="trademarkFooter">
                    Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                </div><div class="copyrightFooter">
                    Copyright Â© 2011-2017 The Apache Software Foundation.
                </div>
            </div>            
            
        </div>
    </body>
</html>
