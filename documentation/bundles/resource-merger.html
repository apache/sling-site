<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Resource Merger (org.apache.sling.resourcemerger)</title>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <script src='https://www.apachecon.com/event-images/snippet.js'></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
	<!-- Matomo Web Analytics -->
	<script>
	var _paq = window._paq = window._paq || [];
	/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
	/* We explicitly disable cookie tracking to avoid privacy issues */
	_paq.push(['disableCookies']); 
	_paq.push(['trackPageView']);
	_paq.push(['enableLinkTracking']);
	(function() {
	  var u="https://matomo.privacy.apache.org/";
	  _paq.push(['setTrackerUrl', u+'matomo.php']);
	  _paq.push(['setSiteId', '6']);
	  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	  g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
	})();
	</script>
	<!-- End Matomo Code -->
	<link href='/pagefind/pagefind-ui.css' rel='stylesheet'><script src='/pagefind/pagefind-ui.js' type='text/javascript'></script>
	<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#searchbox" });
    });
	</script>
	
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><section class="searchbox level is-marginless">
                <div id="searchbox"></div>
            </section><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling12/index.html">Sling 12</a></li><li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Sitemap</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="/repolist.html">Repositories</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a class="acevent" data-format="square" data-event="random"></a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/bundles.html">
                                                Bundles
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/resources.html">
                                        resources
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            Resource Merger (org.apache.sling.resourcemerger)
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row" data-pagefind-body="true"><div><section><p><!-- TODO reactivate TOC once JBake moves to flexmark-java -->
</p>
<h1><a href="#introduction" id="introduction">Introduction</a></h1>
<p><strong>This documentation only applies to versions &gt;= 1.2 (due to major changes done in <a href="https://issues.apache.org/jira/browse/SLING-3423">SLING-3423</a>)</strong></p>
<p>The Resource Merger bundle provides two resource provider factories</p>
<ul>
<li><code>MergingResourceProvider</code> (only for reading)</li>
<li><code>CRUDMergingResourceProvider</code> (for reading and writing)</li>
</ul>
<p>Those providers give access to virtual resources which provide a merged view on multiple other resources.</p>
<p>Each <code>MergedResourcePicker</code> service implementation in the system provides one unique mount point/root path (usually starting with <code>/mnt</code>) exposing a view on merged resources from at least two different locations.</p>
<p>The exact merging mechanism depends on the resource picker implementation (see below). The order of the merging is important as the overlying resource may overwrite properties/child resources from the underlying resource (but not vice-versa). It is possible to</p>
<ul>
<li>remove existing resources/properties from the underlying resources,</li>
<li>modify existing properties/child resources of the underlying resources and</li>
<li>add new properties/child resources</li>
</ul>
<p>You may use any of the merge properties described below to influence the merging behaviour. All those special properties are not exposed below the mount point.</p>
<p>The <code>CRUDMergingResourceProvider</code> not only gives read-access to the merged resources but even allows to write. This provider always writes inside the topmost resource path (being returned as last item by the resource picker). Currently both resource pickers shipped with the Sling Resource Merger bundle do not allow to write though. Further details can be found in the description of <a href="https://issues.apache.org/jira/browse/SLING-3909">SLING-3909</a>.</p>
<h1><a href="#merge-properties" id="merge-properties">Merge Properties</a></h1>
<table>
<thead>
<tr><th>Property Name </th><th> Type </th><th> Description</th></tr>
</thead>
<tbody>
<tr><td>sling:hideProperties </td><td> String[] </td><td> Hides the properties matching the given names. The exact syntax is described below.</td></tr>
<tr><td>sling:hideChildren</td><td> String[] </td><td> Hides the child resources with the given names.  The exact syntax is described below.</td></tr>
<tr><td>sling:hideResource </td><td> Boolean </td><td> If <code>true</code> then the resource with the name which contains this property should not be exposed!</td></tr>
<tr><td>sling:orderBefore </td><td> String </td><td> Contains the name of the preceding sibling resource. This is influencing the order of resources when calling e.g. <code>Resource.listChildren()</code> or <code>Resource.getChildren()</code> on the merged resource. This is only necessary if the default child resource order is not sufficient (see below).</td></tr>
</tbody>
</table>
<h2><a href="#slinghidepropertieshidechildren-syntax" id="slinghidepropertieshidechildren-syntax">sling:hideProperties/hideChildren syntax</a></h2>
<p>Both properties <code>sling:hideProperties</code> and <code>sling:hideChildren</code> take multiple string values which either act as allow list or as deny list. They are treated as deny list if the first value is starting with an odd number of <code>!</code> otherwise as allow list.</p>
<p>In case negated (odd number of leader <code>!</code> ) and non-negated values are mixed in one property the first one determines the list type, and all values of the other type are just skipped!</p>
<p>For deny lists an implicit wildcard is assumed, i.e. everything is allowed except for the names given in negated form. Giving an explicit wildcard (<code>*</code>) is optional and does not change the semantics.</p>
<p>Each value can either be <code>*</code> which is treated as wildcard (i.e. matches all names) or a string with no placeholders. That string is unescaped by removing half of the leading <code>!</code> characters. That allows to negate arbitrary item names (even ones starting with one or multiple <code>!</code>).</p>
<table>
<thead>
<tr><th>Escaped Value </th><th> Unescaped Value </th><th> Is negated</th></tr>
</thead>
<tbody>
<tr><td>!name </td><td> name </td><td> yes</td></tr>
<tr><td>name </td><td> name </td><td> no</td></tr>
<tr><td>!!name </td><td> !name </td><td> no</td></tr>
<tr><td>!!!name </td><td> !name </td><td> yes</td></tr>
<tr><td>!!!!name!test </td><td> !!name!test </td><td> no</td></tr>
</tbody>
</table>
<p>The matching algorithm just compares the item name (either resource or property name) with each of the given unescaped values. It matches if at least one is equal from an allow list or none is equal from a deny list.</p>
<p>Since version 1.3.2 the wildcard only affects underlying child resources and no longer local ones, see also <a href="https://issues.apache.org/jira/browse/SLING-5468">SLING-5468</a>.</p>
<h1><a href="#child-resource-order" id="child-resource-order">Child Resource Order</a></h1>
<p>For a merged resource the order of its child resources is the following: First the ones from the underlying resource, then the ones from the overlying resources.</p>
<p>In case the same child is defined in more than one resource, its position is taken from the highest overlaying resource (since version 1.3.2, see also <a href="https://issues.apache.org/jira/browse/SLING-4915">SLING-4915</a>, for some more examples for more complicated merges look at <a href="https://issues.apache.org/jira/browse/SLING-6956">SLING-6956</a>). For example:</p>
<pre><code>base/
	+--child1
	+--child3
	+--child5
	
overlay/
	+--child2
	+--child3
	+--child4
	
resulting order: child1, child5, child2, child3, child4
</code></pre>
<p>You can overwrite that behaviour by leveraging the <code>sling:orderBefore</code> property.</p>
<h1><a href="#resource-type-handling" id="resource-type-handling">Resource Type Handling</a></h1>
<p>When resources are merged into a new resource, the resource type of the merged resource is set to the resource type of the last resource used for merging (see Resource Picks).</p>
<p>The resource super type is set to the merged value of the 'sling:resourceType' property - if it exists and its value is not the same as the resource type.</p>
<p>However, the 'sling:resourceType' and 'sling:resourceSuperType' property in the returned value map might not reflect these values. These are purely set based on the merging of the properties of the merged resources. For example, if the last resource does not set the 'sling:resourceType' property, then Resource#getResourceType() will return a different value than the property.</p>
<h1><a href="#resource-pickers" id="resource-pickers">Resource Pickers</a></h1>
<h2><a href="#merging-resource-picker-overlay-approach" id="merging-resource-picker-overlay-approach">Merging Resource Picker (Overlay approach)</a></h2>
<table>
<thead>
<tr><th>Description </th><th> Merged Resource Path </th><th> Merging Order </th><th> Read-Only </th><th> Related Ticket</th></tr>
</thead>
<tbody>
<tr><td>Merging based on the resource resolver's search path </td><td> <code>/mnt/overlay/&lt;relative resource path&gt;</code> </td><td> Last resource resolver search path first (Order = Descending search paths). </td><td> <code>true</code> </td><td>  <a href="http://issues.apache.org/jira/browse/SLING-2986">SLING-2986</a></td></tr>
</tbody>
</table>
<p>This picker is thought for globally overlaying content by placing the diff-resource in &quot;/apps&quot; without actually touching anything in &quot;/libs&quot; (since this is only thought for Sling itself). This should be used whenever some deviation of content is desired which is initially shipped with Sling. The client (i.e. the code using the merged resource) does not have to know if there is an overlay in place.</p>
<h3><a href="#example" id="example">Example</a></h3>
<pre><code>/libs/sling/example (nt:folder)
     +-- sling:resourceType = &quot;some/resource/type&quot;
     +-- child1 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child1&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     

/apps/sling/example (sling:Folder)
     +-- property1 = &quot;property added in apps&quot;
     +-- child1 (nt:folder)
     |   +-- sling:hideResource = true
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;


/mnt/overlay/sling/example (sling:Folder)
     +-- sling:resourceType = &quot;some/resource/type&quot;
     +-- property1 = &quot;property added in apps&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;
</code></pre>
<h2><a href="#overriding-resource-picker-override-approach" id="overriding-resource-picker-override-approach">Overriding Resource Picker (Override approach)</a></h2>
<table>
<thead>
<tr><th>Description </th><th> Merged Resource Path </th><th> Merging Order </th><th> Read-Only </th><th> Related Ticket</th></tr>
</thead>
<tbody>
<tr><td>Merging based on the <code>sling:resourceSuperType</code> </td><td> <code>/mnt/override/&lt;absolute resource type&gt;</code> </td><td> The topmost resource type (having itself no <code>sling:resourceSuperType</code> defined) is the base. The resources are overlaid in the order from the most generic one to the most specific one (which is the one having the most inheritance levels). </td><td> <code>true</code> </td><td> <a href="https://issues.apache.org/jira/browse/SLING-3657">SLING-3675</a></td></tr>
</tbody>
</table>
<p>This picker is thought for extending content of another already existing resource (which should not be modified). The client (i.e. the code using the merged resource) must directly reference the most specific resource type (i.e. it must be aware of the sub resource type).</p>
<h3><a href="#example" id="example">Example</a></h3>
<pre><code>/apps/sling/base (nt:folder)
     +-- child1 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child1&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     

/apps/sling/example (sling:Folder)
	 +-- sling:resourceSuperType = &quot;/apps/sling/base&quot;
     +-- property1 = &quot;property added in /apps/sling/example&quot;
     +-- child1 (nt:folder)
     |   +-- sling:hideResource = true
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;


/mnt/override/apps/sling/example (sling:Folder)
     +-- sling:resourceSuperType = &quot;/apps/sling/base&quot;
     +-- property1 = &quot;property added in /apps/sling/example&quot;
     +-- child2 (nt:folder)
     |   +-- property1 = &quot;property from /apps/sling/example/child2&quot;
     +-- child3 (nt:folder)
     |   +-- property1 = &quot;property from /libs/sling/example/child3&quot;
     |   +-- property2 = &quot;property from /apps/sling/example/child3&quot;
</code></pre>
</section></div></div><div data-pagefind-body="true" data-pagefind-weight="7.0" style="display:none;"> - ( Resource Merger (org.apache.sling.resourcemerger) )</div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="editpagelink">
                        This page can be edited on GitHub at <a href="https://github.com/apache/sling-site/edit/master/src/main/jbake/content/documentation/bundles/resource-merger.md">
                            content/documentation/bundles/resource-merger.md
                        </a>
                    </div>                    <div class="revisionInfo">
                        Last modified by <span class="author">Konrad Windszus</span> on <span class="comment">2023-10-12</span>
                    </div><p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project
    logo are trademarks of The Apache Software Foundation. All other marks mentioned 
    may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright © 2007-2024<a href="https://www.apache.org/">
                            The Apache Software Foundation
                        </a>|<a href="https://privacy.apache.org/policies/privacy-policy-public.html">
                            Privacy Policy
                        </a>
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>