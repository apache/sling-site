<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Resource Access Security</title>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <script src='https://www.apachecon.com/event-images/snippet.js'></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Sitemap</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="/repolist.html">Repositories</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a class="acevent" data-format="square" data-event="random"></a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/bundles.html">
                                                Bundles
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/security.html">
                                        security
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            Resource Access Security
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row"><div><section><h1><a href="#summary" id="summary">Summary</a></h1>
<p>The <code>ResourceAccessSecurity</code> service allows to restrict access to resources. The access can be granted or denied for read, create, update, delete and order resources actions.</p>
<p>The <code>ResourceAccessSecurity</code> interface defines a service API which is used in two different context:</p>
<ol>
<li>for securing resource providers which have no own access control and</li>
<li>on the application level to further restrict the access to resources in general.</li>
</ol>
<p>A resource access security service is registered with the service property <code>context</code>. Allowed values are <code>application</code> and <code>provider</code>. If the value is missing or invalid, the service will be ignored.</p>
<p>In the context of resource providers, this service might be used for those  providers where the underlying persistence layer does not implement access control. The goal is to make it easy to implement a lightweight access control for such providers. On the other hand a JCR resource providers should not use the provider context resource access security - in a JCR context, security is fully delegated to the underlying repository, and mixing security models would be a bad idea.</p>
<p>In the context of the application, this service might be used to add additional or temporary constraints across the whole resource tree. It is automatically called by the Resource Resolver implementation.</p>
<h1><a href="#default-implementation" id="default-implementation">Default Implementation</a></h1>
<p>To use the <code>ResourceAccessSecurity</code> service just rely on the default implementation provided by the <a href="https://github.com/apache/sling-org-apache-sling-resourceaccesssecurity"><code>resourceaccesssecurity</code>bundle</a>. This adds an implementation of the <code>ResourceAccessSecurity</code> service for the provider context (<code>provider</code>) and also the application context (<code>application</code>).</p>
<p>Furthermore this implementation of <code>ResourceAccessSecurity</code> defines a service provider interface (SPI) named <code>ResourceAccessGate</code>. This is the service interface which you can implement and register to control the access to particular resources.</p>
<p>The <code>ResourceAccessGate</code> interface defines an SPI which can be used to make some restrictions for accessing resources. Implementations of this service interface must be registered like <code>ResourceProvider</code>s with a path (like <code>provider.roots</code> but with the property name <code>path</code>). If multiple <code>ResourceAccessGate</code> services match a path, not only the <code>ResourceAccessGate</code> with the longest path will be called, but all of them. That is different from the ResourceProvider logic, but in this case more logical (and more secure!). The access gates also must be registered with a context (<code>application</code> or <code>provider</code>), without a given context, the service will be ignored by ResourceAccessSecurity. The gates will be called in the order of the service ranking (from highest to lowest). If one of the gates grants access for a given operation access will be granted. An exception are the gates which are registered for <code>finaloperations</code>. If such a gate denies resource access no further gate will be asked and access will be ultimately denied (except a gate with higher service ranking has granted access).</p>
<h2><a href="#service-properties-for-resourceaccessgate-services" id="service-properties-for-resourceaccessgate-services">Service properties for <code>ResourceAccessGate</code> services</a></h2>
<table>
<thead>
<tr><th>Name     </th><th>  Description </th><th> Default</th></tr>
</thead>
<tbody>
<tr><td><code>path</code>              </td><td> Regular expression to restrict on which paths the service should be called </td><td> <code>.*</code></td></tr>
<tr><td><code>operations</code>        </td><td> Set of operations on which the service should be called. Allowed string values: <code>read</code>,<code>create</code>,<code>update</code>,<code>delete</code>,<code>execute</code>,<code>order-children</code>. The value <code>order-children</code> is only supported since version 1.1.0 (<a href="https://issues.apache.org/jira/browse/SLING-7975">SLING-7975</a>) </td><td> <code>{ &quot;read&quot;,&quot;create&quot;,&quot;update&quot;,&quot;delete&quot;,&quot;execute&quot;,&quot;order-children&quot;}</code> (all operations)</td></tr>
<tr><td><code>finaloperations</code>   </td><td> Set of operations on which the service answer is final and no further service should be called, except the GateResult is GateResult.CANT_DECIDE. Allows the same values as <code>operations</code>. </td><td> (none)</td></tr>
<tr><td><code>context</code>          </td><td> The resource access gate can either have the context <code>provider</code> in which case the gate is only applied to resource providers requesting the security checks or the context <code>application</code> in which case the access gate is invoked for the whole resource tree. If the property is missing or invalid, the service is ignored. </td><td> (none)</td></tr>
</tbody>
</table>
<h2><a href="#how-to-implement-resourceaccessgate" id="how-to-implement-resourceaccessgate">How to implement <code>ResourceAccessGate</code></a></h2>
<p>The implementation is straightforward: The easiest way is to extend <code>AllowingResourceAccessGate</code> which is exported by the <code>resourceaccesssecurity</code> bundle and does not deny any access. So if you want to restrict access on resources for read operations you have to implement to following two methods:</p>
<pre><code><!-- TODO syntax marker (::java) disabled -->@Override
public boolean hasReadRestrictions(final ResourceResolver resourceResolver) {
	return true;
}

@Override
public GateResult canRead(final Resource resource) {
	GateResult returnValue = GateResult.CANT_DECIDE;
	if( whatever-condition ) {
		returnValue = GateResult.GRANTED;
	}
	else {
		returnValue = GateResult.DENIED;
	}
  
	return returnValue;
}
</code></pre>
<p>You have to register the <code>ResourceAccessGate</code> with service properties outlined above.</p>
<p>Tip: We do not recommend to mix up application and provider context in the same application. This can lead to confusing configurations in the ResourceAccessGate implementations.</p>
<h2><a href="#gateresult" id="gateresult">GateResult</a></h2>
<p>GateResult does have three states:</p>
<ol>
<li><code>GateResult.GRANTED</code></li>
<li><code>GateResult.DENIED</code></li>
<li><code>GateResult.CANT_DECIDE</code></li>
</ol>
<p>The first two of them are self-explanatory. <code>CANT_DECIDE</code> means that the actual gate neither can grant nor deny the access. If no other gate does return <code>GRANTED</code> or <code>DENIED</code> the access to the resource will be denied for security reasons. <code>CANT_DECIDE</code> comes handy if you declare <code>finaloperations</code> (where no other gate will be called after this gate). If such a gate returns <code>CANT_DECIDE</code>, further gates will be called regardless of the <code>finaloperations</code> property.</p>
<h2><a href="#resourceaccessgates-implementations" id="resourceaccessgates-implementations"><code>ResourceAccessGates</code> Implementations</a></h2>
<p>There is an implementation of <code>ResourceAccessGate</code> provided by <a href="https://github.com/apache/sling-org-apache-sling-jcr-resourcesecurity">bundle <code>org.apache.sling.jcr.resourcesecurity</code></a> which grants/denies access based on the permissions set on a JCR node. <em>This should only be used for paths not provided by the JCR Resource Provider</em>. It is implemented as service factory so each OSGi configuration provides a dedicated <code>ResourceAccessGate</code> service.</p>
<h2><a href="#limitations" id="limitations">Limitations</a></h2>
<p>By now the implementation is complete for securing access on resource level for CRUD operations. It is not yet ready to allow fine granular access rights on properties/values of a resource. So at the moment the <code>canReadValue, canUpdateValue, canDeleteValue</code> and <code>canCreateValue</code> on <code>ResourceAccessGate</code> methods are ignored (<a href="https://issues.apache.org/jira/browse/SLING-10906">SLING-10906</a>).</p>
</section></div></div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="editpagelink">
                        This page can be edited on GitHub at <a href="https://github.com/apache/sling-site/edit/master/src/main/jbake/content/documentation/bundles/resource-access-security.md">
                            content/documentation/bundles/resource-access-security.md
                        </a>
                    </div>                    <div class="revisionInfo">
                        Last modified by <span class="author">Konrad Windszus</span> on <span class="comment">2021-11-04</span>
                    </div><p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright Â© 2007-2022 The Apache Software Foundation.
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>