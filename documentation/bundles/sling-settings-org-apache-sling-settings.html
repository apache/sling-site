<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Sling Settings and Run Modes (org.apache.sling.settings)</title>
        <link rel="icon" href="/res/favicon.ico"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Site Map</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="https://github.com/apache/?utf8=%E2%9C%93&q=sling">GitHub</a></li><li><a href="https://gitbox.apache.org/repos/asf?s=sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a href="https://www.apache.org/events/current-event.html" class="column">
                                        <img border="0" alt="Current ASF Events" src="https://www.apache.org/events/current-event-125x125.png" width="125"/>
                                    </a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/bundles.html">
                                                Bundles
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/configuration.html">
                                        configuration
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/runmodes.html">
                                        runmodes
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            Sling Settings and Run Modes (org.apache.sling.settings)
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row"><div><section><h1><a href="#overview" id="overview">Overview</a></h1>
<p>The Sling Settings Bundle exposes the <code>SlingSettingsService</code> which allows access to the following information pertinent to a Sling instance:</p>
<table>
<thead>
<tr><th> Method </th><th> Bundle Context Property </th><th> Description </th></tr>
</thead>
<tbody>
<tr><td> <code>String getSlingId()</code> </td><td> (-) </td><td> A unique identifier of the running Sling instance. This value is created when Sling is first started and may be used to identify the instance, for example if multiple Sling instances are running on top of a Jackrabbit Repository Cluster </td></tr>
<tr><td> <code>String getSlingHomePath()</code> </td><td> <code>sling.home</code> </td><td> The absolute filesystem path to the directory where Sling stores all its content </td></tr>
<tr><td> <code>URL getSlingHome()</code> </td><td> <code>sling.home.url</code> </td><td> The Sling Home path as an <code>java.net.URL</code> instance </td></tr>
<tr><td> <code>Set&lt;String&gt; getRunModes()</code> </td><td> <code>sling.run.modes</code> </td><td> The active Run Modes of the running Sling instance </td></tr>
</tbody>
</table>
<p>The new Sling Settings Bundle replaces the former <code>org.apache.sling.runmode</code> bundle and the <code>SlingSettingsService</code> previously provided by the Sling Engine bundle, as it also implements the run modes logic.</p>
<h1><a href="#selecting-the-active-run-modes" id="selecting-the-active-run-modes">Selecting the active run modes</a></h1>
<p>The run modes are selected based on the <code>sling.run.modes</code> property (the &quot;selection property&quot;), specified in the Sling settings file or as a command-line parameter (which takes precedence), out of the valid run modes defined by the properties described below. The value is a String which contains a list of comma-separated run modes. If a run mode is given here which is not contained in any group of valid run modes (given in <code>sling.run.mode.install.options</code> or <code>sling.run.mode.options</code>) it is always active, on the other hand run modes which are contained in any of the predefined groups may be modified/removed (see below for the details).</p>
<p>Using <code>-Dsling.run.modes=foo,bar</code> on the JVM command-line, for example, activates the <em>foo</em> and <em>bar</em> run modes if that combination is valid.</p>
<p>The absolute truth about run modes definition and selection is found in the <a href="https://github.com/apache/sling-org-apache-sling-settings/blob/master/src/test/java/org/apache/sling/settings/impl/RunModeImplTest.java">RunModeImplTest</a> which should be self-explaining.</p>
<h2><a href="#defining-valid-run-modes" id="defining-valid-run-modes">Defining valid run modes</a></h2>
<p>Since <a href="https://issues.apache.org/jira/browse/SLING-2662">SLING-2662</a> the valid run modes are defined by the <code>sling.run.mode.options</code> and <code>sling.run.mode.install.options</code> configuration properties, usually defined in the <code>sling.properties</code> file or in the provisioning model of a Sling Launchpad instance.</p>
<p>The <code>sling.run.mode.install.options</code> property is only used on the first startup on the Sling instance and the run modes that it defines cannot be changed later.</p>
<p>The <code>sling.run.mode.options</code> property on the other hand is used at each startup, so the run modes that it defines can be changed between executions of a given Sling instance.</p>
<p>The value of the both these properties is a string which looks like:</p>
<pre><code>red,green,blue|one|moon,mars
</code></pre>
<p>where <em>comma-separated run modes form a group</em>. The individual groups are separated by a pipe character (<code>|</code>, which is not an OR operation, it's just as separator). A group defines a number of run modes which are <strong>mutually exclusive</strong>. It means once a group is defined, exactly one run mode will be active from that group.</p>
<p>The example from above consists out of 3 different groups</p>
<ol>
<li><code>red,green,blue</code></li>
<li><code>one</code></li>
<li><code>moon,mars</code></li>
</ol>
<p>The rules for determining the active run modes from the selected run mode (<code>sling.run.modes</code>) and the run mode options (<code>sling.run.mode.install.options</code> and <code>sling.run.mode.options</code>) are as follows :</p>
<ol>
<li>If none of the run modes in the options are selected, the first one from each group in the options is activated by default.</li>
<li>If one is selected from a group in the options, this is active.</li>
<li>If several are selected from one group in the options, the first one from the list of valid run modes is used.</li>
<li>If the selected run mode is not mentioned in any of the option groups it is active</li>
</ol>
<p>Examples</p>
<pre><code>sling.run.mode.options=a,b|c,d,e
</code></pre>
<table>
<thead>
<tr><th>User defined run modes (e.g. via property <code>sling.run.modes</code>) </th><th> Effectively active run modes</th></tr>
</thead>
<tbody>
<tr><td>(none) </td><td> <code>a,c</code></td></tr>
<tr><td><code>a</code> </td><td> <code>a,c</code></td></tr>
<tr><td><code>b</code> </td><td> <code>b,c</code></td></tr>
<tr><td><code>a,b</code> </td><td> <code>a,c</code></td></tr>
<tr><td><code>a,d</code> </td><td> <code>a,d</code></td></tr>
<tr><td><code>a,e,f</code> </td><td> <code>a,e</code></td></tr>
</tbody>
</table>
<p>Remember to look at the <code>RunModeImplTest</code> mentioned above for details, and feel free to enhance it with useful examples.</p>
<h1><a href="#getting-the-run-modes-of-the-sling-instance" id="getting-the-run-modes-of-the-sling-instance">Getting the Run Modes of the Sling instance</a></h1>
<p>The <code>SlingSettings</code> service provides the Run Modes of the running Sling instance as in this example:</p>
<pre><code><!-- TODO syntax marker (::java) disabled -->SlingSettings settings = ...get from BundleContext...
Set&lt;String&gt; currentRunModes = settings.getRunModes();

Set&lt;String&gt; expectedRunModes = new HashSet&lt;String&gt;(){{ add(&quot;foo&quot;);add(&quot;wii&quot;); }};
if(expectedRunModes.removeAll(currentRunModes)) {
  // at least one of (foo,wii) run modes
  // is active
}
</code></pre>
<p>Getting run modes in this way is usually not needed, it's better to define bundles or configurations that are only valid in specific run modes, rather than making decisions in code based on run modes.</p>
<h1><a href="#decisions-based-on-run-modes" id="decisions-based-on-run-modes">Decisions based on Run Modes</a></h1>
<p>Since version 1.4.0 (<a href="https://issues.apache.org/jira/browse/SLING-9031">SLING-9031</a> and <a href="https://issues.apache.org/jira/browse/SLING-8548">SLING-8548</a>) of the Sling Settings bundle there is support for checking a run mode spec against the currently active run modes.</p>
<p>The run mode spec grammar is as follows</p>
<pre><code>run mode spec ::= disjunctions
disjunctions ::= conjunctions { &quot;,&quot; conjunctions }
conjunctions ::= conjunction { '.' conjunction }
conjunction ::= notrunmode | runmode
notrunmode ::= '-' runmode
</code></pre>
<p>It supports OR (<code>,</code>) and AND (<code>.</code>) combinations of run modes and negations with <code>-</code> .</p>
<p>Programmatically this can be used via <code>SlingSettings.getBestRunModeMatchCountFromSpec(String runModeSpec)</code>.</p>
</section></div></div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="revisionInfo">
                        Last modified by <span class="author">Konrad Windszus</span> on <span class="comment">Fri Sep 18 17:26:30 2020 +0200</span>
                    </div>                    <p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright Â© 2007-2021 The Apache Software Foundation.
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>