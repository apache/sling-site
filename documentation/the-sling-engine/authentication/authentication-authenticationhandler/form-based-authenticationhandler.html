<!DOCTYPE html><html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <title>Apache Sling :: Form Based AuthenticationHandler</title>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/res/css/bulma.min.css"/>
        <link rel="stylesheet" href="/res/css/site.css"/>
        <script src='https://www.apachecon.com/event-images/snippet.js'></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script><script>
            hljs.initHighlightingOnLoad();
        </script>
        
	<!-- Matomo Web Analytics -->
	<script>
	var _paq = window._paq = window._paq || [];
	/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
	/* We explicitly disable cookie tracking to avoid privacy issues */
	_paq.push(['disableCookies']); 
	_paq.push(['trackPageView']);
	_paq.push(['enableLinkTracking']);
	(function() {
	  var u="https://matomo.privacy.apache.org/";
	  _paq.push(['setTrackerUrl', u+'matomo.php']);
	  _paq.push(['setSiteId', '6']);
	  var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	  g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
	})();
	</script>
	<!-- End Matomo Code -->
	<link href='/pagefind/pagefind-ui.css' rel='stylesheet'><script src='/pagefind/pagefind-ui.js' type='text/javascript'></script>
	<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#searchbox" });
    });
	</script>
	
    </head>    <body>
        <div class="section">
            <div class="level is-marginless">
<div class="logo">
                    <a href="https://sling.apache.org">
                        <img border="0" alt="Apache Sling" src="/res/logos/sling.svg"/>
                    </a>
                </div><div class="header">
                    <a href="https://www.apache.org">
                        <img border="0" alt="Apache" src="/res/logos/apache.png"/>
                    </a>
                </div>                
            </div><section class="searchbox level is-marginless">
                <div id="searchbox"></div>
            </section><div class="columns is-gapless">
                <div class="column is-narrow sidemenu">
<div class="container">
                        <nav class="menu">
                            <ul class="menu-list box is-shadowless is-marginless">
                                <li>
                                    <p class="menu-label">
                                        <strong>Documentation</strong>
                                    </p><ul>
                                        <li><a href="/documentation.html">Overview</a></li><li><a href="/documentation/getting-started.html">Getting Started</a></li><li><a href="/documentation/the-sling-engine.html">The Sling Engine</a></li><li><a href="/documentation/development.html">Development</a></li><li><a href="/documentation/bundles.html">Bundles</a></li><li><a href="/documentation/tutorials-how-tos.html">Tutorials &amp; How-Tos</a></li><li><a href="/components/">Maven Plugins</a></li><li><a href="/documentation/configuration.html">Configuration</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>API Docs</strong>
                                    </p><ul>
                                        <li><a href="/apidocs/sling13/index.html">Sling 13</a></li><li><a href="/apidocs/sling12/index.html">Sling 12</a></li><li><a href="/apidocs/sling11/index.html">Sling 11</a></li><li><a href="/apidocs/sling10/index.html">Sling 10</a></li><li><a href="/apidocs/sling9/index.html">Sling 9</a></li><li><a href="/documentation/apidocs.html">All versions</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Support</strong>
                                    </p><ul>
                                        <li><a href="https://s.apache.org/sling.wiki">Wiki</a></li><li><a href="https://s.apache.org/sling.faq">FAQ</a></li><li><a href="/sitemap.html">Sitemap</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Project Info</strong>
                                    </p><ul>
                                        <li><a href="/downloads.cgi">Downloads</a></li><li><a href="https://www.apache.org/licenses/">License</a></li><li><a href="/news.html">News</a></li><li><a href="/releases.html">Releases</a></li><li><a href="https://issues.apache.org/jira/browse/SLING">Issue Tracker</a></li><li><a href="/links.html">Links</a></li><li><a href="/contributing.html">Contributing</a></li><li><a href="/project-information.html">Project Information</a></li><li><a href="/project-information/security.html">Security</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Source</strong>
                                    </p><ul>
                                        <li><a href="/repolist.html">Repositories</a></li><li><a href="https://gitbox.apache.org/repos/asf#sling">Git at Apache</a></li>
                                    </ul>
                                </li><li>
                                    <p class="menu-label">
                                        <strong>Apache Software<br>Foundation</strong>
                                    </p><ul>
                                        <li><a href="https://www.apache.org/foundation/thanks.html">Thanks!</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html">Become a Sponsor</a></li><li><a href="https://www.apache.org/foundation/buy_stuff.html">Buy Stuff</a></li>
                                    </ul>
                                </li><li>
                                    <a class="acevent" data-format="square" data-event="random"></a>
                                </li><li>
                                    <a href="https://apache.org/foundation/contributing.html" class="column">
                                        <img border="0" alt="Support the Apache Software Foundation!" src="/res/images/SupportApache-small.png" width="125"/>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>                    
                </div><div class="column main">
                    <div class="box is-shadowless is-marginless">
                        <div class="level">
                            <div class="pagenav">
<div class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="/">
                                                Home
                                            </a>
                                        </li><li>
                                            <a href="/documentation.html">
                                                Documentation
                                            </a>
                                        </li><li>
                                            <a href="/documentation/the-sling-engine.html">
                                                The Sling Engine
                                            </a>
                                        </li><li>
                                            <a href="/documentation/the-sling-engine/authentication.html">
                                                Authentication
                                            </a>
                                        </li><li>
                                            <a href="/documentation/the-sling-engine/authentication/authentication-authenticationhandler.html">
                                                Authentication - AuthenticationHandler
                                            </a>
                                        </li>
                                    </ul>
                                </div>                                
                            </div><div class="tags">
                                <span class="tag">
                                    <a href="/tags/core.html">
                                        core
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/authentication.html">
                                        authentication
                                    </a>
                                </span><span class="tag">
                                    <a href="/tags/formauth.html">
                                        formauth
                                    </a>
                                </span>
                            </div>
                        </div><h1 class="title">
                            Form Based AuthenticationHandler
                        </h1><nav class="menu">
                            <ul class="menu-list box is-shadowless is-paddingless">
                                <li id="generatedToC">
                                    <p class="menu-label">
                                        <strong>Table of Contents</strong>
                                    </p>
                                </li>
                            </ul>
                        </nav><script src='/res/jquery-3.2.1.min.js' type='text/javascript'></script><script src='/res/tocjs-1-1-2.js' type='text/javascript'></script><script type='text/javascript'>$(document).ready(function() { $('#generatedToC').toc({'selector':'h1[class!=title],h2,h3','ulClass':'menu-list'}); } );</script><div class="content is-marginless">
<div class="row" data-pagefind-body="true"><div><section><p><!-- TODO reactivate TOC once JBake moves to flexmark-java -->
</p>
<p>The Form Based AuthenticationHandler has two authentication phases: The first phase is presenting a login form to the user and passing the entered user name and password to the server. The second phase is storing successful authentication in a Cookie or an HTTP Session.</p>
<p>The implementation of the Form Based Authentication Handler follows the guidelines of the Servlet API 2.4 specification for <em>Form Based Authentication</em> in section SRV.12.5.3. Specifically the following requirements are implemented:</p>
<ul>
<li>For the initial form submission, the request URL must end with <code>/j_security_check</code> and the user name and password names must be <code>j_username</code> and <code>j_password</code>, resp.</li>
<li>The authentication type as returned by <code>HttpServletRequest.getAuthType()</code> is set to <code>HttpServletRequest.FORM_AUTH</code>.</li>
</ul>
<p>The Form Based Authentication Handler is maintained in the <a href="https://github.com/apache/sling-org-apache-sling-auth-form">the Sling repo</a>.</p>
<h3><a href="#authenticationhandler-implementation" id="authenticationhandler-implementation">AuthenticationHandler implementation</a></h3>
<ul>
<li><code>extractCredentials</code> -- Prepares credentials for the form entered data or from the Cookie or HTTP Session attribute. Returns <code>null</code> if neither data is provided in the request</li>
<li><code>requestCredentials</code> -- Redirects the client (browser) to the login form</li>
<li><code>dropCredentials</code> -- Remove the Cookie or remove the HTTP Session attribute</li>
</ul>
<h3><a href="#authenticationfeedbackhandler-implementation" id="authenticationfeedbackhandler-implementation">AuthenticationFeedbackHandler implementation</a></h3>
<ul>
<li><code>authenticationFailed</code> -- Remove the Cookie or remove the HTTP Session attribute</li>
<li><code>authenticationSucceeded</code> -- Set (or update) the Cookie or HTTP Session attribute</li>
</ul>
<h3><a href="#phase-1-form-submission" id="phase-1-form-submission">Phase 1: Form Submission</a></h3>
<p>The login form submitted in phase 1 to validate the user name and password must be provided in an HTTP <code>POST</code> request to an URL whose last segment is <code>j_security_check</code>. The request is ignored as a form submission if either the method is not <code>POST</code> or the last segment is no <code>j_security_check</code>.</p>
<p>The form is rendered by redirecting the client to the URL indicated by the <code>form.login.form</code> configuration parameter. This redirection request may accompanyied by the following parameters:</p>
<ul>
<li><code>resource</code> -- The resource to which the user should be redirected after successful login. This request parameter should be submitted back to the server as the <code>resource</code> parameter.</li>
<li><code>j_reason</code> -- This parameter indicates the reason for rendering the login form. If this parameter is set, it is set to <code>INVALID_CREDENTIALS</code> indicating a previous form submission presented invalid username and password or <code>TIMEOUT</code> indicating a login session has timed out. The login form servlet/script can present the user with an appropriate message.</li>
</ul>
<p>The Form Based Authentication Handlers supports the following request parameters submitted by the HTML form:</p>
<ul>
<li><code>j_username</code> -- Name of the user to authenticate</li>
<li><code>j_password</code> -- Password to authenticate the user</li>
<li><code>j_validate</code> -- Flag indicating whether to just validate the credentials</li>
<li><code>resource</code> -- The location to go to on successful login</li>
<li><code>sling.auth.redirect</code> -- The location to redirect to on successful login</li>
</ul>
<p>The <code>j_username</code> and <code>j_password</code> parameters are used to create a JCR <code>SimpleCredentials</code> object to log into the JCR Repository.</p>
<p>The <code>j_validate</code> parameter may be used to implement login form submission using AJAX. If this parameter is set to <code>true</code> (case-insensitive) the credentials are used to login and after success or failure to return a status code:</p>
<table>
<thead>
<tr><th> Status </th><th> Description </th></tr>
</thead>
<tbody>
<tr><td> <code>200 OK</code> </td><td> Authentication succeeded; credentials are valid for login; the Cookie or HTTP Session attribute is now set </td></tr>
<tr><td> <code>403 FORBIDDEN</code> </td><td> Authentication failed; credentials are invalid for login; the Cookie or HTTP Session attribute is not set (if it was set, it is now cleared) </td></tr>
</tbody>
</table>
<p>If the <code>j_validate</code> parameter is not set or is set to any value other than <code>true</code>, the request processing depends on authentication success or failure:</p>
<table>
<thead>
<tr><th> Authentication </th><th> Description </th></tr>
</thead>
<tbody>
<tr><td> Success </td><td> Client is redirected to the authenticated resource; the Cookie or HTTP Session attribute is now set. </td></tr>
<tr><td> Failure </td><td> The request is redirected to the login form again; the Cookie or HTTP Session attribute is not set (if it was set, it is now cleared) </td></tr>
</tbody>
</table>
<p>The <code>resource</code> and <code>sling.auth.redirect</code> parameters provide similar functionality but with differing historical backgrounds. The <code>resource</code> parameter is based on the <code>resource</code> request attribute which is set by the login servlet to indicate the original target resource the client desired when it was forced to authenticate. The <code>sling.auth.redirect</code> parameter can be used by clients (applications like cURL or plain HTML forms) to request being redirected after successful login. If both parameters are set, the <code>sling.auth.redirect</code> parameter takes precedence.</p>
<p>The Form Based Authentication Handler contains a <a href="https://github.com/apache/sling-org-apache-sling-auth-form/blob/master/src/main/java/org/apache/sling/auth/form/impl/AuthenticationFormServlet.java">default form servlet</a> and <a href="https://github.com/apache/sling-org-apache-sling-auth-form/blob/master/src/main/resources/org/apache/sling/auth/form/impl/login.html">HTML form template</a>.</p>
<h3><a href="#phase-2-authenticated-requests" id="phase-2-authenticated-requests">Phase 2: Authenticated Requests</a></h3>
<p>After the successful authentication of the user in phase 1, the authentication state is stored in a Cookie or an HTTP Session. The stored value is a security token with the following contents:</p>
<pre><code>HmacSHA1(securetoken, &lt;securetokennumber&gt;&lt;expirytime&gt;@&lt;userID&gt;)@&lt;securetokennumber&gt;&lt;expirytime&gt;@&lt;userID&gt;
</code></pre>
<p>The <code>securetoken</code> and <code>securetokennumber</code> are related in that an table of secure tokens is maintained where the <code>securetoken</code> is an entry in the table and the <code>securetokennumber</code> is the index in of the token in the table.</p>
<p>The secure tokens are refreshed periodically causing the authentication state stored in the Cookie or the HTTP Session to be updated peridocally. This periodic update has two advantages:</p>
<ul>
<li>Login sessions time out after some period of inactivity: If a request is handled for an authentication state whose expiry time has passed, the request is considered unauthenticated.</li>
<li>If a Cookie would be stolen or an HTTP Session be hijacked, the authentication state expires within a reasonable amount of time to try to prevent stealing the authentication.</li>
</ul>
<p>The authentication state may be transmitted with a Cookie which is configured as follows:</p>
<ul>
<li><em>Cookie Path</em> -- Set to the servlet context path</li>
<li><em>Domain</em> -- See below</li>
<li><em>Age</em> -- Set to -1 to indicate a session Cookie</li>
<li><em>Secure</em> -- Set to the value returned by the <code>ServletRequest.isSecure()</code> method</li>
</ul>
<p>If the authentication state is kept in an HTTP Session the setup of the session ID cookie is maintained by the servlet container and is outside of the control of the Form Based AuthenticationHandler.</p>
<h3><a href="#configuration" id="configuration">Configuration</a></h3>
<p>The Form Based Authentication Handler is configured with configuration provided by the OSGi Configuration Admin Service using the <code>org.apache.sling.formauth.FormAuthenticationHandler</code> service PID.</p>
<table>
<thead>
<tr><th> Parameter </th><th> Default </th><th> Description </th></tr>
</thead>
<tbody>
<tr><td> <code>form.login.form</code> </td><td> <code>/system/sling/form/login</code> </td><td> The URL (without any context path prefix) to redirect the client to to present the login form. </td></tr>
<tr><td> <code>form.auth.storage</code> </td><td> <code>cookie</code> </td><td> The type of storage used to provide the authentication state. Valid values are <code>cookie</code> and <code>session</code>. The default value also applies if any setting other than the supported values is configured. </td></tr>
<tr><td> <code>form.auth.name</code> </td><td> <code>sling.formauth</code> </td><td> The name of the Cookie or HTTP Session attribute providing the authentication state. </td></tr>
<tr><td> <code>form.auth.timeout</code> </td><td> <code>30</code> </td><td>The number of minutes after which a login session times out. This value is used as the expiry time set in the authentication data. </td></tr>
<tr><td> <code>form.credentials.name</code> </td><td> <code>sling.formauth</code> </td><td> The name of the <code>SimpleCredentials</code> attribute used to provide the authentication data to the <code>LoginModulePlugin</code>. </td></tr>
<tr><td> <code>form.token.file</code> </td><td> <code>cookie-tokens.bin</code> </td><td> The name of the file used to persist the security tokens. </td></tr>
<tr><td> <code>form.default.cookie.domain</code> </td><td> </td><td> The domain on which cookies will be set, unless overridden in the <code>AuthenticationInfo</code> object. </td></tr>
</tbody>
</table>
<p><em>Note:</em> The <code>form.token.file</code> parameter currently refers to a file stored in the file system. If the path is a relative path, the file is either stored in the Authentication Handler bundle private data area or -- if not possible -- below the location indicated by the <code>sling.home</code> framework property or -- if <code>sling.home</code> is not set -- the current working directory. In the future this file may be store in the JCR Repository to support clustering scenarios.</p>
<h4><a href="#overriding-the-default-login-page" id="overriding-the-default-login-page">Overriding the default login page</a></h4>
<p>The default login page can be overridden by providing a custom login page. To do so, create a <a href="https://docs.osgi.org/specification/osgi.core/8.0.0/framework.module.html#framework.module.fragmentbundles">Fragment Bundle</a> that contains the custom login page.</p>
<p>The bundle must attach itself to the <code>org.apache.sling.auth.form</code> bundle using the <code>Fragment-Host</code> header in the <code>MANIFEST.MF</code> file. The value of the <code>Fragment-Host</code> header must be <code>org.apache.sling.auth.form</code>.</p>
<p>The custom login page must be located at <code>org/apache/sling/auth/form/impl/custom_login.html</code> in the fragment bundle.</p>
<p>An example of such a bundle is available in the Sling Samples repository at https://github.com/apache/sling-samples/tree/master/custom-login-form.</p>
<h3><a href="#security-considerations" id="security-considerations">Security Considerations</a></h3>
<p>Form Based Authentication has some limitations in terms of security:</p>
<ol>
<li>User name and password are transmitted in plain text in the initial form submission.</li>
<li>The Cookie used to provide the authentication state or the HTTP Session ID may be stolen.</li>
</ol>
<p>To prevent eavesdroppers from sniffing the credentials or stealing the Cookie a secure transport layer should be used such as TLS/SSL, VPN or IPSec.</p>
</section></div></div><div data-pagefind-body="true" data-pagefind-weight="7.0" style="display:none;"> - ( Form Based AuthenticationHandler )</div>                            
                        </div>
                    </div>
                </div>
            </div><footer class="footer">
                <div class="content has-text-centered is-small">
<div class="editpagelink">
                        This page can be edited on GitHub at <a href="https://github.com/apache/sling-site/edit/master/src/main/jbake/content/documentation/the-sling-engine/authentication/authentication-authenticationhandler/form-based-authenticationhandler.md">
                            content/documentation/the-sling-engine/authentication/authentication-authenticationhandler/form-based-authenticationhandler.md
                        </a>
                    </div>                    <div class="revisionInfo">
                        Last modified by <span class="author">Robert Munteanu</span> on <span class="comment">2025-01-17</span>
                    </div><p>
                        Apache Sling, Sling, Apache, the Apache feather logo, and the Apache Sling project
    logo are trademarks of The Apache Software Foundation. All other marks mentioned 
    may be trademarks or registered trademarks of their respective owners.
                    </p><p>
                        Copyright © 2007-2025<a href="https://www.apache.org/">
                            The Apache Software Foundation
                        </a>|<a href="https://privacy.apache.org/policies/privacy-policy-public.html">
                            Privacy Policy
                        </a>
                    </p>
                </div>
            </footer>
        </div>
    </body>
</html>